!function(){var t={33042:function(t,e,n){var r;!function(){"use strict";var o=function t(e){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),o={use_static:!1};function i(t){var e=Object.getPrototypeOf(t);return e?Object.create(e):{}}function a(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:n})}function s(t,e){a(t,e,(function(){throw new g("The "+e+" method cannot be invoked on an Immutable data structure.")}))}"object"!=typeof(n=e)||Array.isArray(n)||null===n||void 0!==e.use_static&&(o.use_static=Boolean(e.use_static));var u="__immutable_invariants_hold";function c(t){return"object"!=typeof t||(null===t||Boolean(Object.getOwnPropertyDescriptor(t,u)))}function l(t,e){return t===e||t!=t&&e!=e}function d(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof Date)}var f=["setPrototypeOf"],p=f.concat(["push","pop","sort","splice","shift","unshift","reverse"]),h=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),y=f.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function g(t){this.name="MyError",this.message=t,this.stack=(new Error).stack}function v(t,e){for(var n in a(t,u,!0),e)e.hasOwnProperty(n)&&s(t,e[n]);return Object.freeze(t),t}function E(t,e){var n=t[e];a(t,e,(function(){return z(n.apply(t,arguments))}))}function b(t,e,n){var r=n&&n.deep;if(t in this&&(r&&this[t]!==e&&d(e)&&d(this[t])&&(e=z.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var o=I.call(this);return o[t]=z(e),_(o)}g.prototype=new Error,g.prototype.constructor=Error;var O=z([]);function T(t,e,n){var r=t[0];if(1===t.length)return b.call(this,r,e,n);var o,i=t.slice(1),a=this[r];if("object"==typeof a&&null!==a)o=z.setIn(a,i,e);else{var s=i[0];o=""!==s&&isFinite(s)?T.call(O,i,e):N.call(U,i,e)}if(r in this&&a===o)return this;var u=I.call(this);return u[r]=o,_(u)}function _(t){for(var e in h){if(h.hasOwnProperty(e))E(t,h[e])}o.use_static||(a(t,"flatMap",w),a(t,"asObject",P),a(t,"asMutable",I),a(t,"set",b),a(t,"setIn",T),a(t,"update",G),a(t,"updateIn",Y),a(t,"getIn",k));for(var n=0,r=t.length;n<r;n++)t[n]=z(t[n]);return v(t,p)}function m(){return new Date(this.getTime())}function w(t){if(0===arguments.length)return this;var e,n=[],r=this.length;for(e=0;e<r;e++){var o=t(this[e],e,this);Array.isArray(o)?n.push.apply(n,o):n.push(o)}return _(n)}function L(t){if(void 0===t&&0===arguments.length)return this;if("function"!=typeof t){var e=Array.isArray(t)?t.slice():Array.prototype.slice.call(arguments);e.forEach((function(t,e,n){"number"==typeof t&&(n[e]=t.toString())})),t=function(t,n){return-1!==e.indexOf(n)}}var n=i(this);for(var r in this)this.hasOwnProperty(r)&&!1===t(this[r],r)&&(n[r]=this[r]);return x(n)}function I(t){var e,n,r=[];if(t&&t.deep)for(e=0,n=this.length;e<n;e++)r.push(A(this[e]));else for(e=0,n=this.length;e<n;e++)r.push(this[e]);return r}function P(t){"function"!=typeof t&&(t=function(t){return t});var e,n={},r=this.length;for(e=0;e<r;e++){var o=t(this[e],e,this),i=o[0],a=o[1];n[i]=a}return x(n)}function A(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,u)||t instanceof Date?t:z.asMutable(t,{deep:!0})}function C(t,e){for(var n in t)Object.getOwnPropertyDescriptor(t,n)&&(e[n]=t[n]);return e}function S(t,e){if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var n,r,o=Array.isArray(t),a=e&&e.deep,s=e&&e.mode||"merge",u=e&&e.merger;function c(t,r,o){var s,c=z(r[o]),f=u&&u(t[o],c,e),p=t[o];void 0===n&&void 0===f&&t.hasOwnProperty(o)&&l(c,p)||(l(p,s=void 0!==f?f:a&&d(p)&&d(c)?z.merge(p,c,e):c)&&t.hasOwnProperty(o)||(void 0===n&&(n=C(t,i(t))),n[o]=s))}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(void 0===n&&(n=C(t,i(t))),delete n[r])}if(o)for(var p=0,h=t.length;p<h;p++){var y=t[p];for(r in y)y.hasOwnProperty(r)&&c(void 0!==n?n:this,y,r)}else{for(r in t)Object.getOwnPropertyDescriptor(t,r)&&c(this,t,r);"replace"===s&&f(this,t)}return void 0===n?this:x(n)}function F(t,e){var n=e&&e.deep;if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(t));return z.merge(this,t,{deep:n,mode:"replace"})}var D,M,j,U=z({});function N(t,e,n){if(!Array.isArray(t)||0===t.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=t[0];if(1===t.length)return R.call(this,r,e,n);var o,a=t.slice(1),s=this[r];if(o=this.hasOwnProperty(r)&&"object"==typeof s&&null!==s?z.setIn(s,a,e):N.call(U,a,e),this.hasOwnProperty(r)&&s===o)return this;var u=C(this,i(this));return u[r]=o,x(u)}function R(t,e,n){var r=n&&n.deep;if(this.hasOwnProperty(t)&&(r&&this[t]!==e&&d(e)&&d(this[t])&&(e=z.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var o=C(this,i(this));return o[t]=z(e),x(o)}function G(t,e){var n=Array.prototype.slice.call(arguments,2),r=this[t];return z.set(this,t,e.apply(r,[r].concat(n)))}function H(t,e){for(var n=0,r=e.length;null!=t&&n<r;n++)t=t[e[n]];return n&&n==r?t:void 0}function Y(t,e){var n=Array.prototype.slice.call(arguments,2),r=H(this,t);return z.setIn(this,t,e.apply(r,[r].concat(n)))}function k(t,e){var n=H(this,t);return void 0===n?e:n}function B(t){var e,n=i(this);if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(n[e]=A(this[e]));else for(e in this)this.hasOwnProperty(e)&&(n[e]=this[e]);return n}function V(){return{}}function x(t){return o.use_static||(a(t,"merge",S),a(t,"replace",F),a(t,"without",L),a(t,"asMutable",B),a(t,"set",R),a(t,"setIn",N),a(t,"update",G),a(t,"updateIn",Y),a(t,"getIn",k)),v(t,f)}function z(t,e,n){if(c(t)||function(t){return"object"==typeof t&&null!==t&&(60103===t.$$typeof||t.$$typeof===r)}(t)||function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)||function(t){return t instanceof Error}(t))return t;if(function(t){return"object"==typeof t&&"function"==typeof t.then}(t))return t.then(z);if(Array.isArray(t))return _(t.slice());if(t instanceof Date)return i=new Date(t.getTime()),o.use_static||a(i,"asMutable",m),v(i,y);var i,s=e&&e.prototype,u=(s&&s!==Object.prototype?function(){return Object.create(s)}:V)();if(null==n&&(n=64),n<=0)throw new g("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in n-=1,t)Object.getOwnPropertyDescriptor(t,l)&&(u[l]=z(t[l],void 0,n));return x(u)}function W(t){return function(){var e=[].slice.call(arguments),n=e.shift();return t.apply(n,e)}}function $(t,e){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?e.apply(r,n):t.apply(r,n)}}return z.from=z,z.isImmutable=c,z.ImmutableError=g,z.merge=W(S),z.replace=W(F),z.without=W(L),z.asMutable=(D=B,M=I,j=m,function(){var t=[].slice.call(arguments),e=t.shift();return Array.isArray(e)?M.apply(e,t):e instanceof Date?j.apply(e,t):D.apply(e,t)}),z.set=$(R,b),z.setIn=$(N,T),z.update=W(G),z.updateIn=W(Y),z.getIn=W(k),z.flatMap=W(w),z.asObject=W(P),o.use_static||(z.static=t({use_static:!0})),Object.freeze(z),z}();void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r)}()}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};!function(){"use strict";n.r(r),n.d(r,{addFetchError:function(){return f},addFetchLog:function(){return l},closeConfirmationPopup:function(){return E},deleteFetchError:function(){return p},deleteFetchLog:function(){return d},deletePreEditContent:function(){return b},effects:function(){return S},fetchData:function(){return c},getFetchError:function(){return R},getFetchLog:function(){return N},getGlobalLayoutMap:function(){return H},getLayout:function(){return j},getLayoutContent:function(){return U},getLayoutRootUUID:function(){return G},hasPreEditContent:function(){return B},isConfirmationPopupOpen:function(){return Y},isLayoutSaving:function(){return k},openConfirmationPopup:function(){return v},registerGlobalLayoutStore:function(){return x},saveLayout:function(){return y},saveLayoutWithoutHistoryEntry:function(){return O},setGlobalLayoutMap:function(){return h},setIsLayoutSaving:function(){return T},setLayoutContent:function(){return u},setPreEditContent:function(){return g}});var t={};n.r(t),n.d(t,{addFetchError:function(){return f},addFetchLog:function(){return l},closeConfirmationPopup:function(){return E},deleteFetchError:function(){return p},deleteFetchLog:function(){return d},deletePreEditContent:function(){return b},fetchData:function(){return c},openConfirmationPopup:function(){return v},saveLayout:function(){return y},saveLayoutWithoutHistoryEntry:function(){return O},setGlobalLayoutMap:function(){return h},setIsLayoutSaving:function(){return T},setLayoutContent:function(){return u},setPreEditContent:function(){return g}});var e={};n.r(e),n.d(e,{getFetchError:function(){return R},getFetchLog:function(){return N},getGlobalLayoutMap:function(){return H},getLayout:function(){return j},getLayoutContent:function(){return U},getLayoutRootUUID:function(){return G},hasPreEditContent:function(){return B},isConfirmationPopupOpen:function(){return Y},isLayoutSaving:function(){return k}});var o=n(33042),i=n.n(o),a=window.divi.data,s=window.divi.middleware;const u=(t,e,n,r)=>({type:"SET_LAYOUT_CONTENT",id:t,content:e,owner:n,syncToServer:r}),c=({id:t,owner:e})=>({type:"FETCH_DATA",id:t,owner:e}),l=(t,e)=>({type:"ADD_FETCH_LOG",id:t,owner:e}),d=t=>({type:"DELETE_FETCH_LOG",id:t}),f=(t,e)=>({type:"ADD_FETCH_ERROR",id:t,owner:e}),p=t=>({type:"DELETE_FETCH_ERROR",id:t}),h=(t,e)=>({type:"SET_GLOBAL_LAYOUT_MAP",id:t,map:e}),y=t=>({type:"SAVE_LAYOUT",...t}),g=t=>({type:"SET_PRE_EDIT_CONTENT",...t}),v=t=>({type:"OPEN_CONFIRMATION_POPUP",...t}),E=t=>({type:"CLOSE_CONFIRMATION_POPUP",...t}),b=t=>({type:"DELETE_PRE_EDIT_CONTENT",...t}),O=t=>({type:"SAVE_LAYOUT_WITHOUT_HISTORY_ENTRY",...t}),T=({id:t,isSaving:e})=>({type:"SET_IS_LAYOUT_SAVING",id:t,isSaving:e});var _=window.lodash,m=window.divi.conversion,w=window.divi.editPost,L=window.divi.moduleUtils,I=window.divi.rest;const P=(t,e)=>{t.forEach((t=>{(0,a.dispatch)("divi/edit-post").setGlobalParentAttribute(t,e);const n=(0,a.select)("divi/edit-post").getModule(t),r=(0,_.get)(n,"children").asMutable();r.length>0&&P(r,e)}))};var A=window.divi.serializedPost;const C=t=>{const{id:e}=t;if(!(0,a.select)("divi/settings").checkRolePermission("edit_global_library"))return;const n=(0,a.select)("divi/global-layouts").getLayoutContent(e),r=new FormData,o=(0,A.serializeModuleFlatObjects)(n);r.append("layout_id",e),r.append("content",o),(0,a.dispatch)("divi/global-layouts").setIsLayoutSaving({id:e,isSaving:!0}),(0,I.loggedFetch)({method:"POST",restRoute:"/divi/v1/divi-library/save",data:r},!0).then((()=>{(0,a.dispatch)("divi/global-layouts").deletePreEditContent({id:e}),(0,a.dispatch)("divi/global-layouts").setIsLayoutSaving({id:e,isSaving:!1})})).catch((t=>{console.log(t)}))},S={FETCH_DATA:[t=>{if((0,a.select)("divi/global-layouts").getFetchLog(t.id))return void(0,a.dispatch)("divi/global-layouts").addFetchLog(t.id,t.owner);const e=new FormData;e.append("post_id",t.id),(0,a.dispatch)("divi/global-layouts").deleteFetchError(t.id),(0,a.dispatch)("divi/global-layouts").addFetchLog(t.id,t.owner),(0,I.loggedFetch)({method:"POST",restRoute:"/divi/v1/divi-library/load",data:e},!0).then((e=>{(0,a.select)("divi/global-layouts").getFetchLog(t.id).forEach((n=>{((t,e,n)=>{const r=(0,m.maybeConvertContent)(e),o=(0,L.maybeUnwrapPlaceholderBlock)(r),i=(0,w.parseSerializedPostIntoFlatModuleObject)(o);(0,a.dispatch)("divi/edit-post").mergeGlobalModules(i,n),(0,_.forEach)(i,(({parent:e,children:n},r)=>{"root"===e&&((0,a.dispatch)("divi/edit-post").setGlobalModuleAttribute(r,t),n&&P(n,t))})),(0,_.forEach)(i.root.children,(e=>{(0,a.dispatch)("divi/global-layouts").setLayoutContent(t,i,e,!1)}))})(t.id,e.post_content,n)}))})).catch((e=>{console.log(e),(0,a.dispatch)("divi/global-layouts").addFetchError(t.id,t.owner)})).finally((()=>{(0,a.dispatch)("divi/global-layouts").deleteFetchLog(t.id)}))}],SET_LAYOUT_CONTENT:[t=>{const e=[],n=(0,a.select)("divi/edit-post").getGlobalLayoutOwners(t.id);(0,_.forEach)(n,(t=>{const n=(0,a.select)("divi/edit-post").getModuleWithChildren(t),r={};(0,_.forEach)(Object.keys(n),(t=>{const{children:e}=n[t];r[t]={children:e}})),e.push(r)})),(0,a.dispatch)("divi/global-layouts").setGlobalLayoutMap(t.id,i()(e))}],SAVE_LAYOUT:[C],SAVE_LAYOUT_WITHOUT_HISTORY_ENTRY:[C]};var F=window.vendor.wp.i18n;const D={SAVE_LAYOUT:[()=>t=>e=>{(0,a.dispatch)("divi/history").enableHistoryTracking();const n=(0,F.__)("Updated Global Layout","et_builder"),r=e.owner,o=(0,a.select)("divi/edit-post").getModuleName(r),i=new Date,s=i.getTime(),u=i.toLocaleTimeString(),c=(0,a.select)("divi/edit-post").getContent();(0,a.dispatch)("divi/history").addLayoutItem({label:n,moduleId:r,moduleLabel:"Global Layout",moduleName:o,state:c,timestamp:s,humanTime:u,type:"EDIT_MODULE_ATTRIBUTE",storeName:"divi/global-layouts"});return t(e)}]},M=(t,e)=>{switch(e.type){case"SET_LAYOUT_CONTENT":return t.setIn(["layouts",e.id,"content"],e.content).setIn(["layouts",e.id,"owners"],(0,_.uniq)(t.getIn(["layouts",e.id,"owners"],[]).concat(e.owner))).setIn(["layouts",e.id,"content","root","isGlobal"],!0);case"SET_PRE_EDIT_CONTENT":return t.setIn(["layouts",e.id,"preEditContent"],e.content);case"DELETE_PRE_EDIT_CONTENT":return t.setIn(["layouts",e.id],t.getIn(["layouts",e.id]).without("preEditContent"));case"ADD_FETCH_LOG":return t.setIn(["fetchLog",e.id],t.getIn(["fetchLog",e.id],[]).concat(e.owner));case"DELETE_FETCH_LOG":return t.setIn(["fetchLog"],t.getIn(["fetchLog"]).without(e.id));case"ADD_FETCH_ERROR":return t.setIn(["fetchError",e.id],t.getIn(["fetchError",e.id],[]).concat(e.owner));case"DELETE_FETCH_ERROR":return t.setIn(["fetchError"],t.getIn(["fetchError"]).without(e.id));case"SET_GLOBAL_LAYOUT_MAP":return t.setIn(["layouts",e.id,"modulesMap"],e.map);case"OPEN_CONFIRMATION_POPUP":return t.setIn(["layouts",e.id,"isConfirmationPopupOpen"],!0);case"CLOSE_CONFIRMATION_POPUP":return t.setIn(["layouts",e.id,"isConfirmationPopupOpen"],!1);case"SET_IS_LAYOUT_SAVING":return t.setIn(["layouts",e.id,"isLayoutSaving"],Boolean(e.isSaving));default:return t}},j=(t,e)=>t.getIn(["layouts",e]),U=(t,e)=>t.getIn(["layouts",e,"content"]),N=(t,e)=>t.getIn(["fetchLog",e]),R=(t,e)=>t.getIn(["fetchError",e]),G=(t,e)=>t.getIn(["layouts",e,"content","root","children"]),H=(t,e)=>t.getIn(["layouts",e,"modulesMap"]),Y=(t,e)=>t.getIn(["layouts",e,"isConfirmationPopupOpen"],!1),k=(t,e)=>t.getIn(["layouts",e,"isLayoutSaving"],!1),B=(t,e)=>!!t.getIn(["layouts",e,"preEditContent"]),V=i()({layouts:{},fetchLog:{},fetchError:{}}),x=()=>{if((0,a.select)("divi/global-layouts"))return;const n=(0,a.registerStore)("divi/global-layouts",{actions:t,reducer:M,selectors:e,initialState:V});(0,s.applyMiddlewares)(n,D),(0,s.applyEffects)(n,S)}}(),(window.divi=window.divi||{}).globalLayouts=r}();
/*! For license information please see history.js.LICENSE.txt */
!function(){var t={33042:function(t,e,n){var r;!function(){"use strict";var i=function t(e){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),i={use_static:!1};function o(t){var e=Object.getPrototypeOf(t);return e?Object.create(e):{}}function a(t,e,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:n})}function s(t,e){a(t,e,(function(){throw new h("The "+e+" method cannot be invoked on an Immutable data structure.")}))}"object"!=typeof(n=e)||Array.isArray(n)||null===n||void 0!==e.use_static&&(i.use_static=Boolean(e.use_static));var u="__immutable_invariants_hold";function c(t){return"object"!=typeof t||(null===t||Boolean(Object.getOwnPropertyDescriptor(t,u)))}function l(t,e){return t===e||t!=t&&e!=e}function d(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof Date)}var y=["setPrototypeOf"],p=y.concat(["push","pop","sort","splice","shift","unshift","reverse"]),f=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),m=y.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function h(t){this.name="MyError",this.message=t,this.stack=(new Error).stack}function v(t,e){for(var n in a(t,u,!0),e)e.hasOwnProperty(n)&&s(t,e[n]);return Object.freeze(t),t}function g(t,e){var n=t[e];a(t,e,(function(){return G(n.apply(t,arguments))}))}function b(t,e,n){var r=n&&n.deep;if(t in this&&(r&&this[t]!==e&&d(e)&&d(this[t])&&(e=G.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=O.call(this);return i[t]=G(e),S(i)}h.prototype=new Error,h.prototype.constructor=Error;var I=G([]);function T(t,e,n){var r=t[0];if(1===t.length)return b.call(this,r,e,n);var i,o=t.slice(1),a=this[r];if("object"==typeof a&&null!==a)i=G.setIn(a,o,e);else{var s=o[0];i=""!==s&&isFinite(s)?T.call(I,o,e):P.call(U,o,e)}if(r in this&&a===i)return this;var u=O.call(this);return u[r]=i,S(u)}function S(t){for(var e in f){if(f.hasOwnProperty(e))g(t,f[e])}i.use_static||(a(t,"flatMap",A),a(t,"asObject",_),a(t,"asMutable",O),a(t,"set",b),a(t,"setIn",T),a(t,"update",R),a(t,"updateIn",z),a(t,"getIn",F));for(var n=0,r=t.length;n<r;n++)t[n]=G(t[n]);return v(t,p)}function w(){return new Date(this.getTime())}function A(t){if(0===arguments.length)return this;var e,n=[],r=this.length;for(e=0;e<r;e++){var i=t(this[e],e,this);Array.isArray(i)?n.push.apply(n,i):n.push(i)}return S(n)}function E(t){if(void 0===t&&0===arguments.length)return this;if("function"!=typeof t){var e=Array.isArray(t)?t.slice():Array.prototype.slice.call(arguments);e.forEach((function(t,e,n){"number"==typeof t&&(n[e]=t.toString())})),t=function(t,n){return-1!==e.indexOf(n)}}var n=o(this);for(var r in this)this.hasOwnProperty(r)&&!1===t(this[r],r)&&(n[r]=this[r]);return $(n)}function O(t){var e,n,r=[];if(t&&t.deep)for(e=0,n=this.length;e<n;e++)r.push(M(this[e]));else for(e=0,n=this.length;e<n;e++)r.push(this[e]);return r}function _(t){"function"!=typeof t&&(t=function(t){return t});var e,n={},r=this.length;for(e=0;e<r;e++){var i=t(this[e],e,this),o=i[0],a=i[1];n[o]=a}return $(n)}function M(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,u)||t instanceof Date?t:G.asMutable(t,{deep:!0})}function j(t,e){for(var n in t)Object.getOwnPropertyDescriptor(t,n)&&(e[n]=t[n]);return e}function D(t,e){if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var n,r,i=Array.isArray(t),a=e&&e.deep,s=e&&e.mode||"merge",u=e&&e.merger;function c(t,r,i){var s,c=G(r[i]),y=u&&u(t[i],c,e),p=t[i];void 0===n&&void 0===y&&t.hasOwnProperty(i)&&l(c,p)||(l(p,s=void 0!==y?y:a&&d(p)&&d(c)?G.merge(p,c,e):c)&&t.hasOwnProperty(i)||(void 0===n&&(n=j(t,o(t))),n[i]=s))}function y(t,e){for(var r in t)e.hasOwnProperty(r)||(void 0===n&&(n=j(t,o(t))),delete n[r])}if(i)for(var p=0,f=t.length;p<f;p++){var m=t[p];for(r in m)m.hasOwnProperty(r)&&c(void 0!==n?n:this,m,r)}else{for(r in t)Object.getOwnPropertyDescriptor(t,r)&&c(this,t,r);"replace"===s&&y(this,t)}return void 0===n?this:$(n)}function L(t,e){var n=e&&e.deep;if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(t));return G.merge(this,t,{deep:n,mode:"replace"})}var C,k,H,U=G({});function P(t,e,n){if(!Array.isArray(t)||0===t.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=t[0];if(1===t.length)return N.call(this,r,e,n);var i,a=t.slice(1),s=this[r];if(i=this.hasOwnProperty(r)&&"object"==typeof s&&null!==s?G.setIn(s,a,e):P.call(U,a,e),this.hasOwnProperty(r)&&s===i)return this;var u=j(this,o(this));return u[r]=i,$(u)}function N(t,e,n){var r=n&&n.deep;if(this.hasOwnProperty(t)&&(r&&this[t]!==e&&d(e)&&d(this[t])&&(e=G.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=j(this,o(this));return i[t]=G(e),$(i)}function R(t,e){var n=Array.prototype.slice.call(arguments,2),r=this[t];return G.set(this,t,e.apply(r,[r].concat(n)))}function x(t,e){for(var n=0,r=e.length;null!=t&&n<r;n++)t=t[e[n]];return n&&n==r?t:void 0}function z(t,e){var n=Array.prototype.slice.call(arguments,2),r=x(this,t);return G.setIn(this,t,e.apply(r,[r].concat(n)))}function F(t,e){var n=x(this,t);return void 0===n?e:n}function Y(t){var e,n=o(this);if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(n[e]=M(this[e]));else for(e in this)this.hasOwnProperty(e)&&(n[e]=this[e]);return n}function B(){return{}}function $(t){return i.use_static||(a(t,"merge",D),a(t,"replace",L),a(t,"without",E),a(t,"asMutable",Y),a(t,"set",N),a(t,"setIn",P),a(t,"update",R),a(t,"updateIn",z),a(t,"getIn",F)),v(t,y)}function G(t,e,n){if(c(t)||function(t){return"object"==typeof t&&null!==t&&(60103===t.$$typeof||t.$$typeof===r)}(t)||function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)||function(t){return t instanceof Error}(t))return t;if(function(t){return"object"==typeof t&&"function"==typeof t.then}(t))return t.then(G);if(Array.isArray(t))return S(t.slice());if(t instanceof Date)return o=new Date(t.getTime()),i.use_static||a(o,"asMutable",w),v(o,m);var o,s=e&&e.prototype,u=(s&&s!==Object.prototype?function(){return Object.create(s)}:B)();if(null==n&&(n=64),n<=0)throw new h("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in n-=1,t)Object.getOwnPropertyDescriptor(t,l)&&(u[l]=G(t[l],void 0,n));return $(u)}function W(t){return function(){var e=[].slice.call(arguments),n=e.shift();return t.apply(n,e)}}function J(t,e){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?e.apply(r,n):t.apply(r,n)}}return G.from=G,G.isImmutable=c,G.ImmutableError=h,G.merge=W(D),G.replace=W(L),G.without=W(E),G.asMutable=(C=Y,k=O,H=w,function(){var t=[].slice.call(arguments),e=t.shift();return Array.isArray(e)?k.apply(e,t):e instanceof Date?H.apply(e,t):C.apply(e,t)}),G.set=J(N,b),G.setIn=J(P,T),G.update=W(R),G.updateIn=W(z),G.getIn=W(F),G.flatMap=W(A),G.asObject=W(_),i.use_static||(G.static=t({use_static:!0})),Object.freeze(G),G}();void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r)}()},93967:function(t,e){var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var t="",e=0;e<arguments.length;e++){var n=arguments[e];n&&(t=a(t,o(n)))}return t}function o(t){if("string"==typeof t||"number"==typeof t)return t;if("object"!=typeof t)return"";if(Array.isArray(t))return i.apply(null,t);if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]"))return t.toString();var e="";for(var n in t)r.call(t,n)&&t[n]&&(e=a(e,n));return e}function a(t,e){return e?t?t+" "+e:t+e:t}t.exports?(i.default=i,t.exports=i):void 0===(n=function(){return i}.apply(e,[]))||(t.exports=n)}()}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};!function(){"use strict";n.r(r),n.d(r,{DebugUserActivity:function(){return s},HistoryModal:function(){return T},HistoryModalContainer:function(){return w},add:function(){return L},addActionItem:function(){return C},addLayoutItem:function(){return k},allState:function(){return Y},disableHistoryTracking:function(){return H},enableHistoryTracking:function(){return U},getActionItems:function(){return B},getCurrentLayoutIndex:function(){return Z},getLastUserActivity:function(){return tt},getLayoutItems:function(){return et},getRecentSubHistory:function(){return rt},getSavedState:function(){return it},getSubHistory:function(){return nt},getUserActivityStatus:function(){return ot},hasRedo:function(){return at},hasUndo:function(){return st},historyModalDefinition:function(){return A},isHistoryTrackingEnabled:function(){return ut},jumpToLayoutItem:function(){return P},redo:function(){return N},registerHistoryModal:function(){return E},registerHistoryStore:function(){return mt},setLastEditedLayoutState:function(){return R},setSavedState:function(){return x},setUserActivityStatus:function(){return z},undo:function(){return F}});var t={};n.r(t),n.d(t,{add:function(){return L},addActionItem:function(){return C},addLayoutItem:function(){return k},disableHistoryTracking:function(){return H},enableHistoryTracking:function(){return U},jumpToLayoutItem:function(){return P},redo:function(){return N},setLastEditedLayoutState:function(){return R},setSavedState:function(){return x},setUserActivityStatus:function(){return z},undo:function(){return F}});var e={};n.r(e),n.d(e,{allState:function(){return Y},getActionItems:function(){return B},getCurrentLayoutIndex:function(){return Z},getLastUserActivity:function(){return tt},getLayoutItems:function(){return et},getRecentSubHistory:function(){return rt},getSavedState:function(){return it},getSubHistory:function(){return nt},getUserActivityStatus:function(){return ot},hasRedo:function(){return at},hasUndo:function(){return st},isHistoryTrackingEnabled:function(){return ut}});var i=window.vendor.React,o=n.n(i),a=window.divi.data;const s=()=>{const{status:t,last:e}=(0,a.useSelect)((t=>({status:t("divi/history").getUserActivityStatus(),last:t("divi/history").getLastUserActivity()}))),n=new Date(e.timestamp).toLocaleString();return o().createElement("div",{className:"et-vb-user-activity-debug",style:{width:300,padding:20,backgroundColor:"idle"===t?"green":"maroon",position:"fixed",bottom:20,left:20,fontSize:12,lineHeight:"1em",color:"#FFFFFF",zIndex:1e4}},o().createElement("p",null,"Status:",t),o().createElement("p",null,"Last Timestamp:",e.timestamp),o().createElement("p",null,"Last Human Time:",n),o().createElement("p",null,"Last Edited Store:",e.storeName),o().createElement("p",null,"Last Action Type:",e.actionType))};var u=window.lodash,c=window.vendor.wp.i18n,l=window.divi.errorBoundary,d=window.divi.modal,y=n(93967),p=n.n(y),f=window.divi.iconLibrary,m=window.divi.window;const h=({humanTime:t,id:e,label:n,onClick:r,selected:a=!1,timestamp:s})=>{const u=(0,i.useRef)(null);return(0,i.useEffect)((()=>{a&&u?.current?.scrollIntoView()}),[a]),o().createElement("button",{className:p()({"et-vb-history-modal-history-item":!0,"et-vb-history-modal-history-item--selected":a}),"data-item-id":e,onClick:m.handleOnClickFallback,ref:u,type:"button",onMouseDown:()=>{r(e)}},a?o().createElement("span",{className:"et-vb-history-modal-history-item-status"},o().createElement(f.IconSvg,{name:"divi/check",size:11,color:"#FFFFFF"})):null,o().createElement("span",{className:"et-vb-history-modal-history-item-label"},n),o().createElement("span",{className:"et-vb-history-modal-history-item-timestamp","data-timestamp":s},t))},v=({currentLayoutIndex:t,jumpToLayoutItem:e,layoutItems:n})=>{const r=r=>{e(r===t?{layoutIndex:n?.length-1}:{layoutIndex:r})};return o().createElement("div",{className:"et-vb-history-modal-history-item-wrapper"},n.map(((e,n)=>o().createElement(h,{key:`history-item-${e.timestamp}`,humanTime:e.humanTime,id:n,label:e?.label??`${e.type} ${e.moduleName}`,onClick:r,selected:n===t,timestamp:e.timestamp}))))},g=()=>{const{jumpToLayoutItem:t}=(0,a.useDispatch)("divi/history"),{currentLayoutIndex:e,layoutItems:n}=(0,a.useSelect)((t=>({currentLayoutIndex:t("divi/history").getCurrentLayoutIndex(),layoutItems:t("divi/history").getLayoutItems()})));return o().createElement(v,{currentLayoutIndex:e,jumpToLayoutItem:t,layoutItems:n})},b="divi/history",I=(0,c.__)("History","et_builder"),T=({tab:t})=>o().createElement(l.ErrorBoundary,{key:"et-vb-divi-modals--history",componentName:"et-vb-divi-modals--history"},o().createElement(d.WrapperContainer,{modalName:b,modalActiveTab:t||"history",draggable:!0,expandable:!0,snappable:!0,resizable:!0,multiPanels:!0},o().createElement(d.Header,{name:(0,c.__)("History","et_builder"),onContextMenu:u.noop}),o().createElement(d.BodyPanelWrapperContainer,null,o().createElement(d.PanelContainer,{id:"history",label:(0,c.__)("Actions","et_builder")},o().createElement(g,null)))));var S=window.divi.keyboardShortcuts;const w=t=>{(0,i.useEffect)((()=>((0,S.registerShortcut)({name:"closeHistoryModal",label:(0,c.__)("Close History Modal","et_builder"),keys:["Escape"],category:"modal",action:()=>{(0,a.dispatch)("divi/modal-library").close({name:b})}}),()=>{(0,S.unregisterShortcut)("closeHistoryModal")})),[]);const e={tab:t?.tab};return(0,i.createElement)(T,{...t,...e})},A={component:w,name:b,label:I,snappable:!0,type:"multiInstanceModal",autoCloseOnClickOutside:!0},E=()=>{(0,a.dispatch)("divi/modal-library").addModal(A)};var O=n(33042),_=n.n(O),M=window.divi.middleware,j=window.divi.pageSettings,D=window.divi.serializedPost;const L=(t,e,n,r)=>({type:"ADD",category:t,actionType:e,trigger:n,payload:r}),C=t=>({type:"ADD_ACTION_ITEM",params:t}),k=t=>({type:"ADD_LAYOUT_ITEM",params:t}),H=()=>({type:"DISABLE_HISTORY_TRACKING"}),U=()=>({type:"ENABLE_HISTORY_TRACKING"}),P=t=>({type:"JUMP_TO_LAYOUT_ITEM",params:t}),N=()=>({type:"REDO"}),R=t=>({type:"SET_LAST_EDITED_LAYOUT_STATE",params:t}),x=t=>({type:"SET_SAVED_STATE",params:t}),z=t=>({type:"SET_USER_ACTIVITY_STATUS",params:t}),F=()=>({type:"UNDO"}),Y=t=>t,B=(t,e)=>t.getIn(["actions",e.storeName,"items"]);function $(t,e="expected a function, instead received "+typeof t){if("function"!=typeof t)throw new TypeError(e)}var G=t=>Array.isArray(t)?t:[t];function W(t){const e=Array.isArray(t[0])?t[0]:t;return function(t,e="expected all items to be functions, instead received the following types: "){if(!t.every((t=>"function"==typeof t))){const n=t.map((t=>"function"==typeof t?`function ${t.name||"unnamed"}()`:typeof t)).join(", ");throw new TypeError(`${e}[${n}]`)}}(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function J(t,e){const n=[],{length:r}=t;for(let i=0;i<r;i++)n.push(t[i].apply(null,e));return n}Symbol(),Object.getPrototypeOf({});var K="undefined"!=typeof WeakRef?WeakRef:class{constructor(t){this.value=t}deref(){return this.value}};function V(t,e={}){let n={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:r}=e;let i,o=0;function a(){let e=n;const{length:a}=arguments;for(let t=0,n=a;t<n;t++){const n=arguments[t];if("function"==typeof n||"object"==typeof n&&null!==n){let t=e.o;null===t&&(e.o=t=new WeakMap);const r=t.get(n);void 0===r?(e={s:0,v:void 0,o:null,p:null},t.set(n,e)):e=r}else{let t=e.p;null===t&&(e.p=t=new Map);const r=t.get(n);void 0===r?(e={s:0,v:void 0,o:null,p:null},t.set(n,e)):e=r}}const s=e;let u;if(1===e.s?u=e.v:(u=t.apply(null,arguments),o++),s.s=1,r){const t=i?.deref?.()??i;null!=t&&r(t,u)&&(u=t,0!==o&&o--);i="object"==typeof u&&null!==u||"function"==typeof u?new K(u):u}return s.v=u,u}return a.clearCache=()=>{n={s:0,v:void 0,o:null,p:null},a.resetResultsCount()},a.resultsCount=()=>o,a.resetResultsCount=()=>{o=0},a}function q(t,...e){const n="function"==typeof t?{memoize:t,memoizeOptions:e}:t,r=(...t)=>{let e,r=0,i=0,o={},a=t.pop();"object"==typeof a&&(o=a,a=t.pop()),$(a,`createSelector expects an output function after the inputs, but received: [${typeof a}]`);const s={...n,...o},{memoize:u,memoizeOptions:c=[],argsMemoize:l=V,argsMemoizeOptions:d=[],devModeChecks:y={}}=s,p=G(c),f=G(d),m=W(t),h=u((function(){return r++,a.apply(null,arguments)}),...p);const v=l((function(){i++;const t=J(m,arguments);return e=h.apply(null,t),e}),...f);return Object.assign(v,{resultFunc:a,memoizedResultFunc:h,dependencies:m,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>e,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:u,argsMemoize:l})};return Object.assign(r,{withTypes:()=>r}),r}var Q=q(V),X=Object.assign(((t,e=Q)=>{!function(t,e="expected an object, instead received "+typeof t){if("object"!=typeof t)throw new TypeError(e)}(t,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof t);const n=Object.keys(t);return e(n.map((e=>t[e])),((...t)=>t.reduce(((t,e,r)=>(t[n[r]]=e,t)),{})))}),{withTypes:()=>X});const Z=Q([t=>t.getIn(["layout"])],(t=>t.getIn(["current"]))),tt=Q([t=>t.getIn(["userActivity"])],(t=>t.getIn(["last"]))),et=Q([t=>t.getIn(["layout"])],(t=>t.getIn(["items"]))),nt=(t,e,n={})=>t.getIn([e],n),rt=(t,e,n=5)=>nt(t,e,[]).slice(0-n),it=t=>t.getIn(["savedState"]),ot=Q([t=>t.getIn(["userActivity"])],(t=>t.getIn(["status"]))),at=Q([t=>t.getIn(["layout","items","length"]),t=>t.getIn(["layout","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&!(n>=t)})),st=Q([t=>t.getIn(["layout","items","length"]),t=>t.getIn(["layout","current"])],((t,e)=>{const n=e+1;if(!(n>0&&n<=t))return!1;return t>1&&0<e})),ut=t=>t.getIn(["layout","isHistoryTrackingEnabled"]),ct=(0,u.debounce)((()=>{(0,a.dispatch)("divi/history").setUserActivityStatus({status:"idle"}),(0,a.dispatch)("divi/edit-post").clearRemovedModules({layout:(0,a.select)("divi/settings").getSetting(["themeBuilder","layout"]),caller:"user"})}),6e3),lt=(t,e)=>{Z(e.getState())+1===(0,u.size)(et(e.getState()))&&ct()},dt=(t,e)=>{const n=(0,a.select)("divi/modal-library").getModal("divi/module"),r=n?.isActive??!1,i=n?.owner??"",o=e.getState(),s=o.getIn(["layout","items"]),c=o.getIn(["layout","current"]),l=o.getIn(["layout","lastEditedState"]);if(0===Object.keys(l)?.length){const t=(0,a.select)("divi/edit-post").getContent();(0,a.dispatch)("divi/history").setLastEditedLayoutState({layoutState:t})}const d=s?.[c]?.state,y=s?.[c]?.moduleId,p=(0,a.select)("divi/edit-post").getGlobalLayoutId(y),f=!!p;if(r&&!d?.[i]&&(0,a.dispatch)("divi/modal-library").close({name:"divi/module"}),(0,a.dispatch)("divi/edit-post").setLayoutState({location:"content",layoutState:d}),f){const t=(0,a.select)("divi/edit-post").getModuleAttrs(y),e=(0,u.omit)(t,["globalModule","unsyncAttrs","modulePreset"]);(0,a.dispatch)("divi/history").disableHistoryTracking(),(0,u.forEach)(e,((t,e)=>{(0,a.dispatch)("divi/edit-post").editModuleAttribute({id:y,attrName:e,value:t,caller:"history"})})),(0,a.dispatch)("divi/history").enableHistoryTracking(),(0,a.dispatch)("divi/global-layouts").saveLayoutWithoutHistoryEntry({id:p,owner:y})}},yt={ADD_ACTION_ITEM:[lt],ADD_LAYOUT_ITEM:[lt],JUMP_TO_LAYOUT_ITEM:[dt],REDO:[dt],UNDO:[dt]},pt={"*":[()=>t=>e=>{if(!(0,a.select)("divi/history").isHistoryTrackingEnabled()&&"ENABLE_HISTORY_TRACKING"!==e.type)return null;return t(e)}]},ft=(t,e)=>{switch(e.type){case"ADD":{const n=[].concat(t.getIn([e.category],[]));return n.push({actionType:e.actionType,trigger:e.trigger,payload:e.payload}),t.setIn([e.category],n)}case"ADD_ACTION_ITEM":return((t,e)=>{const{storeName:n}=e.params,r=t?.getIn(["actions",n,"limit"])??50,i=t.getIn(["actions",n,"items"]).asMutable({deep:!0});return i.push(e.params),i.length>r&&i?.shift(),t.setIn(["actions",n,"items"],i).setIn(["userActivity","status"],"edited").setIn(["userActivity","last"],{storeName:n,actionType:e?.params?.action?.type,timestamp:e?.params?.timestamp})})(t,e);case"ADD_LAYOUT_ITEM":return((t,e)=>{const n=t.getIn(["layout","items"]),r=t.getIn(["layout","limit"]),i=t.getIn(["layout","current"]),o=i+1,a=o<n.length,s=a?n.slice(0,i+1):n,c=a?i+1:o>=r?r-1:i+1,l=t.setIn(["layout","current"],c).setIn(["layout","items"],s.concat((0,u.omit)(e.params,"storeName"))).setIn(["userActivity","status"],"edited").setIn(["userActivity","last"],{storeName:e?.params?.storeName,actionType:e?.params?.type,timestamp:e?.params?.timestamp});if(l.getIn(["layout","items","length"])>r){const t=l.getIn(["layout","items"]).asMutable();return t?.shift(),l.setIn(["layout","items"],t)}return l})(t,e);case"JUMP_TO_LAYOUT_ITEM":return((t,e)=>t.setIn(["layout","current"],e.params.layoutIndex))(t,e);case"SET_LAST_EDITED_LAYOUT_STATE":return((t,e)=>{const{layoutState:n}=e.params;return t.setIn(["layout","lastEditedState"],n)})(t,e);case"SET_SAVED_STATE":return((t,e)=>t.set("savedState",e.params))(t,e);case"REDO":return(t=>{if(!at(t))return t;const e=t.getIn(["layout","items","length"])-1,n=t.getIn(["layout","current"]),r=Math.min(n+1,e);return t.setIn(["layout","current"],r)})(t);case"UNDO":return(t=>{if(!st(t))return t;const e=t.getIn(["layout","current"]),n=Math.max(e-1,0);return t.setIn(["layout","current"],n)})(t);case"DISABLE_HISTORY_TRACKING":return t.setIn(["layout","isHistoryTrackingEnabled"],!1);case"ENABLE_HISTORY_TRACKING":return t.setIn(["layout","isHistoryTrackingEnabled"],!0);case"SET_USER_ACTIVITY_STATUS":return((t,e)=>t.setIn(["userActivity","status"],e.params.status))(t,e);default:return t}},mt=()=>{if((0,a.select)("divi/history"))return;(0,a.select)("divi/serialized-post")||(0,D.registerSerializedPostStore)(),(0,a.select)("divi/page-settings")||(0,j.registerPageSettingsStore)();const n=_()({actions:{"divi/events":{items:[],limit:50}},"edit-post":[],layout:{current:-1,items:[],lastEditedState:_()({}),limit:50,isHistoryTrackingEnabled:!0},savedState:{content:(0,a.select)("divi/serialized-post").getState(["postContent","content"]),settings:(0,O.asMutable)((0,a.select)("divi/page-settings").getSettings(),{deep:!0})},userActivity:{status:"idle",last:{timestamp:0,storeName:"",actionType:""}}}),r=(0,a.registerStore)("divi/history",{actions:t,reducer:ft,selectors:e,initialState:n});(0,M.applyMiddlewares)(r,pt),(0,M.applyEffects)(r,yt)}}(),(window.divi=window.divi||{}).history=r}();